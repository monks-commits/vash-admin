<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Афіша — Ваш Адмін</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .cards{display:grid;gap:16px}
    @media (min-width:780px){.cards{grid-template-columns: repeat(2, 1fr)}}
    @media (min-width:1100px){.cards{grid-template-columns: repeat(3, 1fr)}}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:14px;display:grid;grid-template-columns:110px 1fr;gap:12px;align-items:center}
    .poster{width:110px;height:150px;object-fit:cover;border-radius:10px;background:#eee}
    .meta{color:#6b7280;font-size:14px;margin:4px 0}
    .filters{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px}
    .filters .btn{height:36px}
    .empty{padding:16px;border:1px dashed #ddd;border-radius:12px;background:#fafafa}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="index.html" class="logo">Ваш Адмін</a>
    <nav class="nav">
      <a href="index.html" class="nav-link">Головна</a>
      <a href="afisha.html" class="nav-link active">Афіша</a>
      <a href="theatres.html" class="nav-link">Театри</a>
      <a href="about.html" class="nav-link">Про нас</a>
      <a href="contacts.html" class="nav-link">Контакти</a>
    </nav>
  </header>

  <main class="container">
    <h1 style="margin:0 0 12px">Афіша</h1>

    <!-- Фільтри міст -->
    <div class="filters">
      <button class="btn" data-city="all">Всі міста</button>
      <button class="btn secondary" data-city="Дніпро">Дніпро</button>
      <button class="btn secondary" data-city="Кривий Ріг">Кривий Ріг</button>
    </div>

    <!-- Список подій -->
    <div id="list" class="cards"></div>

    <!-- Повідомлення про помилку -->
    <div id="error" class="empty" style="display:none"></div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div>© 2025 Ваш Адмін</div>
      <div class="footer-links">
        <a href="https://www.facebook.com/eventsandticketsdnepr/" target="_blank">Facebook</a>
        <a href="https://t.me/zahodiikvitki" target="_blank">Telegram</a>
      </div>
    </div>
  </footer>

  <script>
  (async function(){
    const listEl  = document.getElementById('list');
    const errEl   = document.getElementById('error');
    const btns    = document.querySelectorAll('.filters .btn');

    let all = [];
    let currentCity = 'all';

    // міняємо стиль активної кнопки
    function setActive(city){
      btns.forEach(b=>{
        if ((b.dataset.city||'all')===city){ b.classList.remove('secondary'); }
        else { b.classList.add('secondary'); }
      });
    }

    // рендер карток
    function render(){
      const items = currentCity==='all' ? all : all.filter(x=> (x.city||'').toLowerCase()===currentCity.toLowerCase());
      if (!items.length){
        listEl.innerHTML = `<div class="empty">Подій за вибраним фільтром поки немає.</div>`;
        return;
      }
      listEl.innerHTML = items.map(s => {
        const poster = s.poster ? `./${s.poster}` : '';
        const when   = [s.date, s.time].filter(Boolean).join(' • ');
        const where  = [s.theatre, s.stage].filter(Boolean).join(' • ');
        const href   = `show.html?show=${encodeURIComponent(s.show)}`;
        return `
          <article class="card">
            <img class="poster" src="${poster}" alt="${s.title||''}" onerror="this.style.display='none'">
            <div>
              <h3 style="margin:0 0 6px">${s.title || s.show}</h3>
              <div class="meta">${when}</div>
              <div class="meta">${where}</div>
              <div class="meta">${s.city || ''}</div>
              <div style="margin-top:8px">
                <a class="btn" href="${href}">Обрати місця</a>
              </div>
            </div>
          </article>
        `;
      }).join('');
    }

    // завантаження афіші (важливо: ./data/afisha.json)
    try{
      const r = await fetch('./data/afisha.json', {cache:'no-store'});
      if (!r.ok) throw new Error('HTTP '+r.status);
      all = await r.json();
      if (!Array.isArray(all)) all = [];
      render();
    }catch(e){
      console.error(e);
      errEl.textContent = 'Не вдалося завантажити афішу. Перевірте файл ./data/afisha.json';
      errEl.style.display = 'block';
    }

    // кліки по фільтрам
    btns.forEach(b=>{
      b.addEventListener('click', ()=>{
        currentCity = b.dataset.city || 'all';
        setActive(currentCity);
        render();
      });
    });

    setActive(currentCity);
  })();
  </script>
</body>
</html>
