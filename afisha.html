<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Афіша — Ваш Адмін</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <img src="images/logo-placeholder.png" alt="Ваш Адмін">
        <div>
          <h1>Ваш Адмін</h1>
          <p class="tagline">Квитки без комісій. Дніпро • Кривий Ріг</p>
        </div>
      </div>
      <nav class="nav">
        <a href="index.html">Головна</a>
        <a class="active" href="afisha.html">Афіша</a>
        <a href="theatres.html">Театри</a>
        <a href="about.html">Про нас</a>
        <a href="contacts.html">Контакти</a>
      </nav>
      <div class="social-icons">
        <a class="icon fb" href="https://www.facebook.com/eventsandticketsdnepr/" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
        <a class="icon tg" href="https://t.me/zahodiikvitki" target="_blank"><i class="fa-brands fa-telegram"></i></a>
        <a class="icon ig" href="#" target="_blank"><i class="fa-brands fa-instagram"></i></a>
        <a class="icon tt" href="#" target="_blank"><i class="fa-brands fa-tiktok"></i></a>
      </div>
    </div>
  </header>

  <main class="main">
    <section class="section">
      <div class="tabs" id="cityTabs">
        <button class="btn" data-city="all">Всі міста</button>
        <button class="btn secondary" data-city="Дніпро">Дніпро</button>
        <button class="btn secondary" data-city="Кривий Ріг">Кривий Ріг</button>
      </div>

      <div class="afisha-grid" id="afishaList"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div>© 2025 Ваш Адмін</div>
      <div class="social-icons">
        <a class="icon fb" href="https://www.facebook.com/eventsandticketsdnepr/" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
        <a class="icon tg" href="https://t.me/zahodiikvitki" target="_blank"><i class="fa-brands fa-telegram"></i></a>
        <a class="icon ig" href="#" target="_blank"><i class="fa-brands fa-instagram"></i></a>
        <a class="icon tt" href="#" target="_blank"><i class="fa-brands fa-tiktok"></i></a>
      </div>
    </div>
  </footer>

  <script type="module">
    import { supabase } from './scripts/db.js';

    let allEvents = [];
    let activeCity = 'all';

    async function loadAfisha(){
      const { data, error } = await supabase
        .from('shows')
        .select('id, slug, title, date, time, stage, poster_url, venue, theatres!inner(name,slug,city)')
        .order('date', { ascending: true })
        .order('time', { ascending: true });
      if (error) { console.error(error); return; }
      allEvents = data || [];
      render();
    }

    function render(){
      const list = document.getElementById('afishaList');
      const items = activeCity === 'all' ? allEvents : allEvents.filter(ev => (ev.theatres?.city || '').trim() === activeCity);

      list.innerHTML = items.map(ev => {
        const thSlug = ev.theatres?.slug || 'unknown';
        const showSlug = ev.slug;
        return `
          <div class="card afisha-card">
            <img src="${ev.poster_url || ''}" alt="" onerror="this.style.display='none'">
            <div>
              <div style="font-weight:700">${ev.title}</div>
              <div class="meta">${ev.date} • ${ev.time} • ${ev.venue || ''}</div>
              <div style="margin-top:8px">
                <a class="btn" href="spectacles/show.html?show=${thSlug}/${showSlug}">Детальніше</a>
                <a class="btn secondary" href="spectacles/hall.html?show=${thSlug}/${showSlug}">Вибрати місця</a>
              </div>
            </div>
          </div>
        `;
      }).join('') || '<div class="meta">Немає подій для обраного міста.</div>';
    }

    document.getElementById('cityTabs').addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-city]');
      if (!btn) return;
      activeCity = btn.dataset.city;
      [...document.querySelectorAll('#cityTabs .btn')].forEach(b=>b.classList.toggle('secondary', b.dataset.city !== activeCity));
      render();
    });

    loadAfisha();
  </script>
</body>
</html>
