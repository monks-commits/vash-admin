<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Афіша — Ваш Адмін</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <img src="images/logo-placeholder.png" alt="Ваш Адмін" />
        <div>
          <h1>Ваш Адмін</h1>
          <p class="tagline">Квитки без комісій. Дніпро • Кривий Ріг</p>
        </div>
      </div>
      <nav class="nav">
        <a href="index.html">Головна</a>
        <a class="active" href="afisha.html">Афіша</a>
        <a href="theatres.html">Театри</a>
        <a href="about.html">Про нас</a>
        <a href="contacts.html">Контакти</a>
      </nav>
    </div>
  </header>

  <main class="main">
    <section class="section">
      <div class="pillbar" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px">
        <button class="btn" data-city="all">Всі міста</button>
        <button class="btn secondary" data-city="dnipro">Дніпро</button>
        <button class="btn secondary" data-city="krivyi_rih">Кривий Ріг</button>
      </div>

      <div id="list" class="cards" style="display:grid; gap:16px"></div>
      <div id="err" class="meta" style="color:#b91c1c; margin-top:12px; display:none"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div>© 2025 Ваш Адмін</div>
      <div class="social-icons">
        <a class="icon fb" href="https://www.facebook.com/eventsandticketsdnepr/" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
        <a class="icon tg" href="https://t.me/zahodiikvitki" target="_blank"><i class="fa-brands fa-telegram"></i></a>
        <a class="icon ig" href="#" target="_blank"><i class="fa-brands fa-instagram"></i></a>
        <a class="icon tt" href="#" target="_blank"><i class="fa-brands fa-tiktok"></i></a>
      </div>
    </div>
  </footer>

  <script>
    const listEl = document.getElementById('list');
    const errEl = document.getElementById('err');
    let shows = [];
    let currentCity = 'all';

    async function load() {
      try {
        const r = await fetch('./data/afisha.json?ts=' + Date.now());
        if (!r.ok) throw new Error('HTTP ' + r.status);
        shows = await r.json();
        render();
      } catch (e) {
        errEl.style.display = 'block';
        errEl.textContent = 'Не вдалося завантажити афішу: ' + e.message;
      }
    }

    function render() {
      errEl.style.display = 'none';
      const items = shows.filter(s => currentCity === 'all' ? true : s.city === currentCity);
      if (!items.length) {
        listEl.innerHTML = '<div class="meta">Подій не знайдено.</div>';
        return;
      }
      listEl.innerHTML = items.map(s => cardHTML(s)).join('');
    }

    function cardHTML(s) {
      const date = new Date(s.datetime);
      const dd = date.toLocaleDateString('uk-UA', { day:'2-digit', month:'2-digit', year:'numeric' });
      const tt = date.toLocaleTimeString('uk-UA', { hour:'2-digit', minute:'2-digit' });

      const poster = s.poster || 'images/poster-placeholder.jpg';
      const hallUrl = `spectacles/hall.html?show=${encodeURIComponent(s.show_slug)}`;

      return `
        <article class="card" style="display:grid; grid-template-columns:120px 1fr; gap:12px; align-items:center">
          <img src="${poster}" alt="${s.title}" onerror="this.style.display='none'" style="width:120px; height:160px; object-fit:cover; border-radius:10px; background:#eee" />
          <div>
            <h3 style="margin:0 0 6px">${s.title}</h3>
            <div class="meta" style="margin-bottom:6px">${s.theatre} • ${s.city_label}</div>
            <div class="meta" style="margin-bottom:10px">${dd} • ${tt}</div>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <a class="btn" href="${hallUrl}">Вибрати місця</a>
              <a class="btn secondary" href="${s.details_url || '#'}" target="_blank">Детальніше</a>
            </div>
          </div>
        </article>
      `;
    }

    document.querySelectorAll('.pillbar .btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.pillbar .btn').forEach(b=>b.classList.add('secondary'));
        btn.classList.remove('secondary');
        currentCity = btn.dataset.city;
        render();
      });
    });

    load();
  </script>
</body>
</html>
