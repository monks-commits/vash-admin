<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">Вистава — Ваш Адмін</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .wrap{display:grid;gap:16px}
    @media (min-width:900px){ .wrap{grid-template-columns:280px 1fr} }
    .poster{width:100%;max-width:280px;height:380px;object-fit:cover;border-radius:12px;background:#eee}
    .meta{color:#6b7280;margin:6px 0}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px}
  </style>
</head>
<body>
<header class="header">
  <a href="index.html" class="logo">Ваш Адмін</a>
  <nav class="nav">
    <a href="index.html" class="nav-link">Головна</a>
    <a href="afisha.html" class="nav-link">Афіша</a>
    <a href="theatres.html" class="nav-link">Театри</a>
    <a href="about.html" class="nav-link">Про нас</a>
    <a href="contacts.html" class="nav-link">Контакти</a>
  </nav>
</header>

<main class="container">
  <div id="box" class="card">
    <div id="loading">Завантаження…</div>
    <div id="content" style="display:none">
      <div class="wrap">
        <img id="poster" class="poster" alt="Постер" onerror="this.style.display='none'"/>
        <div>
          <h1 id="title" style="margin:0 0 8px">Вистава</h1>
          <div class="meta" id="when"></div>
          <div class="meta" id="where"></div>
          <div class="meta" id="city"></div>
          <p id="desc" style="margin:14px 0 0"></p>
          <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap">
            <a id="toHall" class="btn">Вибрати місця</a>
            <a href="afisha.html" class="btn secondary">До афіші</a>
          </div>
        </div>
      </div>
    </div>
    <div id="error" class="meta" style="color:#b91c1c; display:none"></div>
  </div>
</main>

<footer class="footer">
  <div class="footer-inner">
    <div>© 2025 Ваш Адмін</div>
    <div class="footer-links">
      <a href="https://www.facebook.com/eventsandticketsdnepr/" target="_blank">Facebook</a>
      <a href="https://t.me/zahodiikvitki" target="_blank">Telegram</a>
    </div>
  </div>
</footer>

<script>
(async function(){
  const qp = new URLSearchParams(location.search);
  const showSlug = qp.get('show'); // напр.: shevchenko/za-dvoma-zaytsiamy

  const els = {
    loading: document.getElementById('loading'),
    content: document.getElementById('content'),
    error:   document.getElementById('error'),
    title:   document.getElementById('title'),
    poster:  document.getElementById('poster'),
    when:    document.getElementById('when'),
    where:   document.getElementById('where'),
    city:    document.getElementById('city'),
    desc:    document.getElementById('desc'),
    toHall:  document.getElementById('toHall'),
    pageTitle: document.getElementById('pageTitle'),
  };

  function showError(msg){
    els.loading.style.display='none';
    els.error.textContent = msg;
    els.error.style.display = 'block';
  }

  if(!showSlug){
    showError('Немає параметра ?show');
    return;
  }

  els.toHall.href = `spectacles/hall.html?show=${encodeURIComponent(showSlug)}`;

  // 1) Пытаемся взять detail JSON
  let info = null;
  try{
    const r = await fetch(`./data/shows/${showSlug}.json`, {cache:'no-store'});
    if (r.ok) info = await r.json();
  }catch(e){}

  // 2) Fallback — ищем запись в афише
  if(!info){
    try{
      const r = await fetch('./data/afisha.json', {cache:'no-store'});
      if (r.ok){
        const data = await r.json();
        const arr = Array.isArray(data) ? data : (data ? [data] : []);
        info = arr.find(x => x && x.show === showSlug) || null;
      }
    }catch(e){}
  }

  if(!info){
    showError('Не вдалося знайти дані вистави.');
    return;
  }

  // Заголовок/тайтл
  const title = info.title || showSlug.split('/').pop().replace(/-/g,' ');
  els.title.textContent = title;
  els.pageTitle.textContent = title + ' — Ваш Адмін';

  // Постер: сначала detail.poster, иначе poster из афиши, иначе прячем
  const posterPath = (info.poster ? ('./'+info.poster) :
                      (info.images && info.images.poster ? info.images.poster : ''));
  if (posterPath) els.poster.src = posterPath; else els.poster.style.display='none';

  // Метаданные
  const when = [info.date, info.time].filter(Boolean).join(' • ');
  const where = [info.theatre, typeof info.stage==='string'?info.stage:''].filter(Boolean).join(' • ');
  els.when.textContent = when || '';
  els.where.textContent = where || '';
  els.city.textContent  = info.city || '';

  // Описание
  els.desc.textContent = info.description || 'Без опису.';

  els.loading.style.display='none';
  els.content.style.display='block';
})();
</script>
</body>
</html>
